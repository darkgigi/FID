```{r}
library(dplyr)
library(ggplot2)
library(tidyr)
library(arules)
library(arulesViz)

# Lectura de dataset
df=read.table("data/student-por.csv",sep=",",header=TRUE)

# Convertir columnas necesarias a factor
cols_to_factor <- c("school", "sex", "address", "famsize", "Pstatus", "Medu", "Fedu", "Mjob", "Fjob", "reason", "guardian", "traveltime", "studytime" ,"famrel", "freetime", "goout", "health")

df[cols_to_factor] <- lapply(df[cols_to_factor], as.factor)

# Ejecutar el algoritmo Apriori asegurando que Dalc esté en el lado derecho de las reglas
rules <- apriori(df_asociation_dalc, 
                 parameter = list(supp = 0.05, conf = 0.9, maxlen = 3),
                 appearance = list(rhs = paste("Dalc=", c("1", "2", "3", "4", "5"), sep="")))

# Inspeccionar las primeras reglas generadas
inspect(head(rules))

# Filtrar por elevación
rules_lift <- subset(rules, lift > 1.2)

# Ordenar por confianza
rules_sorted <- sort(rules_lift, by = "confidence", decreasing = TRUE)

# Inspeccionar reglas filtradas y ordenadas
inspect(head(rules_sorted, 10))

# Visualización básica
plot(rules_sorted)

# Gráfico interactivo
plot(rules_sorted, method = "graph", engine = "htmlwidget")
```
