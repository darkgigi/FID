---
title: "School_alcohol_consumption"
output: html_document
date: "2024-11-10"
---
# Consumo de alcohol en estudiantes

Con este estudio, el objetivo que pretendemos es analizar el consumo de alcohol en estudiantes
y su relación con otras variables. Para ello, vamos a utilizar un dataset que contiene información
sobre estudiantes de dos escuelas portuguesas, incluyendo datos sobre su consumo de alcohol,
características personales, familiares y académicas. 

## Pasos KDD
### Integración
A la hora de observar los dataset, tenemos un dataset para la asignatura de matemáticas y otro para
la asignatura de portugués. Ambos datasets tienen la misma estructura y se pueden unir en un 
único dataset. Sin embargo, en este caso, vamos a trabajar con el dataset de portugués.

Esto se debe a que hay 382 instancias que pertenecen a ambas asignaturas, y no queremos duplicar
la información. Además, el dataset de portugués tiene más instancias que el de matemáticas, 
por lo que nos aportará más información. El hecho de seleccionar el dataset de portugués solamente
excluiría a 13 instancias del dataset de matemáticas, por lo que no perderíamos mucha información
con esta decisión.

Una de las alternativas que estudiamos fue unir ambos datasets y fusionar las instancias duplicadas,
calculando la media de las notas de ambas asignaturas para cada período. Sin embargo, esto 
implicaría una pérdida de información, ya que no podríamos analizar las diferencias entre ambas.

```{r}
install.packages("dplyr")
library(dplyr)
```

```{r}

# Lectura de dataset
df=read.table("data/student-por.csv",sep=",",header=TRUE)

# Convertir columnas necesarias a factor
cols_to_factor <- c("school", "sex", "address", "famsize", "Pstatus", "Mjob", 
                    "Fjob", "reason", "guardian", "schoolsup", "famsup", "paid", 
                    "activities", "nursery", "higher", "internet", "romantic", "subject")

df[cols_to_factor] <- lapply(df[cols_to_factor], as.factor)

print(nrow(df)) # 1044 students
print(head(df))
print(str(df))
```

## Visualización
```{r}
install.packages("ggplot2")
install.packages("tidyverse")
library(ggplot2)
library(tidyr)
```

```{r}	
# Histograma de consumo de alcohol entre semana
ggplot(df, aes(x = Dalc)) +
  geom_histogram(binwidth = 1, fill = "blue", color = "black") +
  labs(title = "Histograma de consumo de alcohol en fin de semana",
       x = "Consumo de alcohol",
       y = "Frecuencia")

```
```{r}	
# Histograma de consumo de alcohol en fin de semana
ggplot(df, aes(x = Walc)) +
  geom_histogram(binwidth = 1, fill = "blue", color = "black") +
  labs(title = "Histograma de consumo de alcohol en fin de semana",
       x = "Consumo de alcohol",
       y = "Frecuencia")
```
```{r}
# Gráfico de dispersión de consumo de alcohol entre semana y en fin de semana
ggplot(df, aes(x = Dalc, y = Walc)) +
  geom_count(aes(color = ..n.., size = ..n..)) +
  scale_size_area(max_size = 10) +
  scale_color_gradient(low = "blue", high = "red") +
  labs(title = "Consumo de alcohol entre semana y fin de semana",
       x = "Consumo de alcohol entre semana",
       y = "Consumo de alcohol fin de semana",
       size = "Cantidad de instancias",
       color = "Cantidad de instancias")
```
```{r}
# Gráfico de tarta de la distribución conjunta de Dalc y Walc
df_count <- df %>%
  count(Dalc, Walc) %>%
  mutate(prop = n / sum(n))
  
ggplot(df_count, aes(x = "", y = prop, fill = interaction(Dalc, Walc))) +
  geom_bar(stat = "identity", width = 1, color = "white") +
  coord_polar("y") +
  scale_fill_manual(name = "Dalc y Walc",
                    labels = paste("Dalc:", df_count$Dalc, "- Walc:", df_count$Walc),
                    values = rainbow(nrow(df_count))) +
  labs(title = "Distribución conjunta del consumo de alcohol entre semana y en fin de semana",
       x = NULL, y = NULL) +
  theme_void()  

```

```{r}
# Gráfico de media de consumo de alcohol según si los padres están separados o no (entre semana vs fin de semana)

df %>%
  group_by(Pstatus) %>%
  summarise(mean_Dalc = mean(Dalc), mean_Walc = mean(Walc)) %>%
  pivot_longer(cols = c(mean_Dalc, mean_Walc), names_to = "Consumo", values_to = "Media") %>%
  ggplot(aes(x = Pstatus, y = Media, fill = Consumo)) +
  geom_bar(stat = "identity", position = "dodge", color = "black") +
  labs(title = "Media de consumo de alcohol según si los padres están separados o no",
       x = "Estado de los padres",
       y = "Media de consumo de alcohol",
       fill = "Consumo") +
  theme_minimal()
```

```{r}
df %>%
  group_by(absences) %>%
  summarise(mean_Dalc = mean(Dalc), mean_Walc = mean(Walc)) %>%
  pivot_longer(cols = c(mean_Dalc, mean_Walc), names_to = "Consumo", values_to = "Media") %>%
  ggplot(aes(x = absences, y = Media, color = Consumo)) +
  geom_line(size = 1) +
  geom_point(size = 2) +
  labs(title = "Media de consumo de alcohol en función de las ausencias escolares",
       x = "Número de ausencias escolares",
       y = "Media de consumo de alcohol",
       color = "Consumo") +
  theme_minimal()
```
