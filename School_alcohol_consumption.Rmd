---
title: "School_alcohol_consumption"
output: html_document
date: "2024-11-10"
---
# Consumo de alcohol en estudiantes

Con este estudio, el objetivo que pretendemos es analizar el consumo de alcohol en estudiantes
y su relación con otras variables. Para ello, vamos a utilizar un dataset que contiene información
sobre estudiantes de dos escuelas portuguesas, incluyendo datos sobre su consumo de alcohol,
características personales, familiares y académicas. 

## Pasos KDD
### Integración
A la hora de observar los dataset, tenemos un dataset para la asignatura de matemáticas y otro para
la asignatura de portugués. Ambos datasets tienen la misma estructura y se pueden unir en un 
único dataset. Sin embargo, en este caso, vamos a trabajar con el dataset de portugués.

Esto se debe a que hay 382 instancias que pertenecen a ambas asignaturas, y no queremos duplicar
la información. Además, el dataset de portugués tiene más instancias que el de matemáticas, 
por lo que nos aportará más información. El hecho de seleccionar el dataset de portugués solamente
excluiría a 13 instancias del dataset de matemáticas, por lo que no perderíamos mucha información
con esta decisión.

Una de las alternativas que estudiamos fue unir ambos datasets y fusionar las instancias duplicadas,
calculando la media de las notas de ambas asignaturas para cada período. Sin embargo, esto 
implicaría una pérdida de información, ya que no podríamos analizar las diferencias entre ambas.

```{r}
install.packages("dplyr")
library(dplyr)
```

```{r}

# Lectura de dataset
df=read.table("data/student-por.csv",sep=",",header=TRUE)

# Convertir columnas necesarias a factor
cols_to_factor <- c("school", "sex", "address", "famsize", "Pstatus", "Medu", "Fedu", "Mjob", 
                    "Fjob", "reason", "guardian", "traveltime", "studytime" ,"famrel"
                    , "freetime", "goout", "health")

df[cols_to_factor] <- lapply(df[cols_to_factor], as.factor)

cols_to_boolean <- c("schoolsup", "famsup", "paid", "activities", "nursery", "higher", "internet", "romantic")

df[cols_to_boolean] <- lapply(df[cols_to_boolean], function(x) x == "yes")

df_long <- tidyr::pivot_longer(df, cols = c("Dalc", "Walc"), names_to = "period", values_to = "consumption")

print(nrow(df)) # 649 students
print(head(df))
print(head(df_long))
```

## Visualización
```{r}
install.packages("ggplot2")
library(ggplot2)
```

```{r}	
# Histograma de consumo de alcohol entre semana vs fin de semana
ggplot() +
  geom_histogram(data = df_long, aes(x = consumption, fill = period), position = position_dodge(), stat = "count", alpha = 0.5, bins = 10) +
  labs(title = "Histograma de consumo de alcohol entre semana y fin de semana",
       x = "Consumo de alcohol",
       y = "Cantidad de instancias",
       fill = "Periodo") +
  theme_minimal()
```
```{r}
# Gráfico de dispersión de consumo de alcohol entre semana y en fin de semana
ggplot(df, aes(x = Dalc, y = Walc)) +
  geom_count(aes(color = after_stat(n), size = after_stat(n))) +
  scale_size_area(max_size = 10) +
  scale_color_gradient(low = "blue", high = "red") +
  labs(title = "Consumo de alcohol entre semana y fin de semana",
       x = "Consumo de alcohol entre semana",
       y = "Consumo de alcohol fin de semana",
       size = "Cantidad de instancias",
       color = "Cantidad de instancias")
```
```{r}
# Gráfico de tarta de la distribución conjunta de Dalc y Walc
df_count <- df %>%
  count(Dalc, Walc) %>%
  mutate(prop = n / sum(n))
  
ggplot(df_count, aes(x = "", y = prop, fill = interaction(Dalc, Walc))) +
  geom_bar(stat = "identity", width = 1, color = "white") +
  coord_polar("y") +
  scale_fill_manual(name = "Dalc y Walc",
                    labels = paste("Dalc:", df_count$Dalc, "- Walc:", df_count$Walc),
                    values = rainbow(nrow(df_count))) +
  labs(title = "Distribución conjunta del consumo de alcohol entre semana y en fin de semana",
       x = NULL, y = NULL) +
  theme_void()  
```

```{r}
# Media de consumo según la nota final
df %>%
  filter(!is.na(G3) & !is.na(Dalc) & !is.na(Walc)) %>%
  group_by(G3) %>%
  summarise(mean_Dalc = mean(Dalc, na.rm = TRUE), 
            mean_Walc = mean(Walc, na.rm = TRUE), 
            count = n()) %>%
  ggplot(aes(x = G3)) +
  geom_point(aes(y = mean_Dalc, color = "Dalc", size = count)) +
  geom_line(aes(y = mean_Dalc, color = "Dalc")) +
  geom_point(aes(y = mean_Walc, color = "Walc", size = count)) +
  geom_line(aes(y = mean_Walc, color = "Walc")) +
  labs(title = "Media de consumo de alcohol según la nota final",
       x = "Nota final",
       y = "Media de consumo de alcohol",
       color = "Tipo de consumo",
       size = "Tamaño del grupo") +
  theme_minimal()

```

```{r}
# Porcentaje de personas perteneciente a cada grupo de consumo según el sexo para Dalc y Walk
df_long %>%
  group_by(sex, period, consumption) %>%
  summarise(count = n()) %>%
  group_by(sex, period) %>%
  mutate(percentage = count / sum(count) * 100) %>%
  ggplot(aes(x = factor(consumption), y = percentage, fill = sex)) +
  geom_bar(stat = "identity", position = "dodge") +
  facet_wrap(~period) +
  labs(title = "Porcentaje de personas perteneciente a cada grupo de consumo según el sexo",
       x = "Consumo de alcohol",
       y = "Porcentaje",
       fill = "Sexo") +
  theme_minimal()
```
